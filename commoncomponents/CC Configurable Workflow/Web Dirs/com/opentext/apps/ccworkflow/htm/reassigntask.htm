<!DOCTYPE html>
<html>

<head>
    <title>Assign user</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="../../../../../com/opentext/apps/utils/css/appscommon.css">
    <link rel="stylesheet" href="../../../../../thirdparty/bootstrap/css/bootstrap.min.css">
    <script src="../../../../../thirdparty/jquery/jquery.js" type="text/javascript"></script>
    <script src="../../../../../html5/cordys.html5sdk.js" type="text/javascript"></script>
	<script src="../../../../../html5/thirdparty/moment.js" type="text/javascript"></script>
    <script src="../../../../../thirdparty/knockout/knockout.js" type="text/javascript"></script>
    <script src="../../../../../thirdparty/bootstrap/js/bootstrap.min.js" type="text/javascript"></script>
    <script src="../../../../../com/opentext/apps/utils/js/appscommon.js" type="text/javascript"></script>
    <script src="../../../../../com/opentext/apps/utils/js/translationsUtil.js" type="text/javascript"></script>
    <script type="text/javascript">
        $.cordys.json.defaults.removeNamespacePrefix = true;
        var l_instanceID = "";
        var l_OrgID = "";
        var UsersListModel = function () {
            var self = this;
            self.UsersList = ko.observableArray([]);
            self.selectedUserID = ko.observable('');
            self.selectedUserName = ko.observable('');
            self.UserRowClicked = function (iItem, event) {
                $(event.currentTarget.parentElement).find('.cc-select-column').removeClass("cc-radio-on");
                $(event.currentTarget).find('.cc-select-column').addClass("cc-radio-on");
                if (iItem.ParticipatingPerson.PersonToUser["Identity-id"]) {
                    var l_Id = iItem.ParticipatingPerson.PersonToUser["Identity-id"].Id;
                    self.selectedUserID(l_Id);
                    self.selectedUserName(getTextValue(iItem.ParticipatingPerson.PersonToUser.IdentityDisplayName));
					$('ai-dialog-footer .btn-primary:contains("Assign")', window.parent.parent.document).attr("disabled", false);
                }
            }
            self.UserRowRadiobuttonClicked = function (iItem, event) {
                $(event.currentTarget.parentElement.parentElement.parentElement).find('.cc-select-column').removeClass("cc-radio-on");
                $(event.currentTarget).find('.cc-select-column').addClass("cc-radio-on");
                if (iItem.ParticipatingPerson.PersonToUser["Identity-id"]) {
                    var l_Id = iItem.ParticipatingPerson.PersonToUser["Identity-id"].Id;
                    self.selectedUserID(l_Id);
                    self.selectedUserName(getTextValue(iItem.ParticipatingPerson.PersonToUser.IdentityDisplayName));
					$('ai-dialog-footer .btn-primary:contains("Assign")', window.parent.parent.document).attr("disabled", false);
                }
                event.stopPropagation();
                return true;
            }
        }
        $(function () {
            var i_locale = getlocale();
            var rtl_css = '../../../../../com/opentext/apps/utils/css/rtlappscommon.css';
            translateLabels("com/opentext/apps/commoncomponents/CCConfigurableWorkflow/CCConfigurableWorkflow", i_locale);
            loadRTLIfRequired(i_locale,rtl_css);
            
            l_instanceID = getUrlParameterValue("instanceId", null, true);
            l_OrgID = getUrlParameterValue("orgID", null, true);

            //Platform dialog enhancements
            platformDialogModifications("Assign", ReassignUsertoTask);
            $('ai-dialog-footer .btn-primary:contains("Assign")', window.parent.parent.document).attr("disabled", true);

            l_usersList_model = new UsersListModel();
            ko.applyBindings(l_usersList_model, document.getElementById("div_usersList"));

            ListOrganizationUsers();
        });
        function platformDialogModifications(i_newButtonName, i_newButtonAction) {
            $('ai-dialog', window.parent.parent.document).animate({
                'max-height': '80vh',
                'max-width': '80vw',
                'width': '80vw',
                'height': '80vh'
            }, 500);

            //Dialog content style enhancements				
            $('ai-dialog-body iframe', window.parent.parent.document).css({
                'width': '100%',
                'height': 'calc(100% - 6px)'
            });

            $('ai-dialog-body', window.parent.parent.document).css({
                'max-height': 'calc(80vh - 103px)',
                'height': '75vh',
            });

            $('.layout-panel .panel-container', window.parent.document).css({
                'padding-left': '0px'
            });

            $('panel-container iframe', window.parent.document).css({
                'height': 'calc(100% - 6px)',
                'width': '100%',
                'border': '0px'
            });
            //hide OK button
            $('ai-dialog-footer .btn-primary:contains("OK")', window.parent.parent.document).hide();
            //Save changes action in footer
            var newBtn = document.createElement("Button");
            newBtn.innerHTML = i_newButtonName;
            newBtn.className = "btn btn-primary";
            newBtn.onclick = i_newButtonAction;
            $('ai-dialog-footer .btn-primary', window.parent.parent.document).before(newBtn);
        }
        function ListOrganizationUsers() {
            var l_userNameFilter = document.getElementById("input_userListSearchFilter");
            $.cordys.ajax({
                namespace: "http://schemas.opentext.com/apps/cc/basiccomponents/20.2",
                method: "GetOrgMemberswithFilters",
                parameters: {
                    "memName": l_userNameFilter.value,
                    "orgName": "",
                    "orgID": l_OrgID!='undefined'?l_OrgID:"",
                    "offset": "0",
                    "limit": "200"
                },
                success: function (data) {
                    addDataToUsersView(data.OrgMembers.FindZ_INT_OrgUsersListResponse.OrganizationMembers, l_usersList_model);
                },
                error: function (responseFailure) {
                    showOrHideErrorInfo("div_modalErrorInfoArea", true, "An error occurred while loading individuals. Contact the administrator.", 10000);
                    return false;
                }
            });
        }
        function addDataToUsersView(iElementList, iModel) {
            iModel.UsersList.removeAll();
            if (iElementList) {
                if (iElementList.length) {
                    iElementList.forEach(function (iElement) {
                        iModel.UsersList.push(iElement);
                    });
                }
                else {
                    iModel.UsersList.push(iElementList);
                }
            }
        }
        function ReassignUsertoTask() {
            $.cordys.ajax({
                namespace: "http://schemas.opentext.com/apps/cc/configworkflow/20.2",
                method: "ReassignCCWorkflowTask",
                parameters: {
                    "gcactivityInstanceID": l_instanceID,
                    "assignToUserID": l_usersList_model.selectedUserID()
                },
                success: function (data) {
                    $('#div_usersList').css('display', 'none');
                    $('#div_reassignSuccessMessg').css('display', 'block');
                    $('ai-dialog-footer .btn-primary:contains("Assign")', window.parent.parent.document).hide()
                    $('ai-dialog-footer .btn:contains("Cancel")', window.parent.parent.document).text("Close");
                },
                error: function (responseFailure) {
                    showOrHideErrorInfo("div_formErrorInfoArea", true, getTranslationMessage("An error occurred while assigning to user. Contact the administrator."), 10000);
                    return false;
                }
            });
        }
    </script>
</head>

<body class="cc-ltr">
    <div id="div_reassignSuccessMessg" class="col-xs-12 cc-info-message" style="display: none;">
        <span data-translatable="true">Task is assigned to selected user.</span>
    </div>
    <div class="cc-error-info-area" id="div_formErrorInfoArea">
        <img src="../../../../../com/opentext/apps/utils/img/notification_error.svg"
            style="width: 11px; height: 11px;" />
        <span id="span_errorInfoMessage" style="position: relative;"></span>
    </div>
    <div id="div_usersList" class="col-md-12 cc-list" style="padding-top: 15px;">
        <div class="input-group" style="margin-bottom: 10px;">
            <input type="text" class="form-control cc-input-browse rtl-input-browse" id="input_userListSearchFilter"
                placeholder="Search by User ID">
            <span class="input-group-addon cc-input-browse-icon rtl-input-browse-icon" style="cursor: pointer;">
                <img class="cc-input-icon" alt="Search"
                    src="../../../../../com/opentext/apps/utils/img/search.svg" onclick="ListAllUsers()">
            </span>
        </div>
        <table class="table cc-border" id="">
            <thead>
                <tr>
                    <th style="width: 10%;"></th>
                    <th style="width: 30%;" data-translatable="true" scope="col">User ID</th>
					<th style="width: 30%;" data-translatable="true" scope="col">First name</th>
                    <th style="width: 30%;" data-translatable="true" scope="col">Organization</th>
                    <th style="width: 30%;" data-translatable="true" scope="col">Start date</th>
                    <th style="width: 30%;" data-translatable="true" scope="col">End date</th>
                </tr>
            </thead>
            <tbody data-bind="foreach:UsersList">
                <tr data-bind="click:$root.UserRowClicked">
                    <td>
                        <div class="cc-select-column cc-radio-off"
                            data-bind="event:{click:$root.UserRowRadiobuttonClicked}"></div>
                    </td>
                    <td data-bind="text:getTextValue(ParticipatingPerson.User_ID)"></td>
					<td data-bind="text:getTextValue(ParticipatingPerson.FirstName)"></td>
                    <td data-bind="text:getTextValue(Owner.Name)"></td>
                    <td data-bind="text:getDateValue(StartDate)"></td>
                    <td data-bind="text:getDateValue(EndDate)"></td>
                </tr>
            </tbody>
        </table>
    </div>
</body>

</html>