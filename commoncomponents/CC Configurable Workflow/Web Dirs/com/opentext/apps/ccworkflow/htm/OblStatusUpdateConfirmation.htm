<!DOCTYPE html>
<html>

<head>
    <title>Extend obligation due date</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="../../../../../com/opentext/apps/utils/css/appscommon.css">
    <link rel="stylesheet" href="../../../../../thirdparty/bootstrap/css/bootstrap.min.css">
    <script src="../../../../../thirdparty/jquery/jquery.js" type="text/javascript"></script>
    <script src="../../../../../html5/cordys.html5sdk.js" type="text/javascript"></script>
    <script src="../../../../../html5/thirdparty/moment.js" type="text/javascript"></script>
    <script src="../../../../../thirdparty/knockout/knockout.js" type="text/javascript"></script>
    <script src="../../../../../thirdparty/bootstrap/js/bootstrap.min.js" type="text/javascript"></script>
    <script src="../../../../../com/opentext/apps/utils/js/appscommon.js" type="text/javascript"></script>
    <script src="../../../../../com/opentext/apps/utils/js/translationsUtil.js" type="text/javascript"></script>
    <link rel="stylesheet" href="../../../../../app/start/web/thirdpartylibs/jquery-datepicker/jquery-ui.min.css" />
    <script src="../../../../../app/start/web/thirdpartylibs/jquery-datepicker/jquery-ui.min.js"
        type="text/javascript"></script>
    <script type="text/javascript">
        $.cordys.json.defaults.removeNamespacePrefix = true;
        var l_OblItemID1 = "";
		var actionType = "";
		var oblStatus=""
		
		var oblUpdateStatus_Services = function () {
			var self = {};

			self.GetContractDetailsById = function (inreq, callbackfunc) {
				$.cordys.ajax({
					method: "GetContractDetailsById",
					namespace: "http://schemas.opentext.com/apps/contractcenter/16.3",
					parameters: { "contractID": inreq },
					success: function (data) {
						callbackfunc(data, "SUCCESS");
					},
					error: function (responseFailure) {
						callbackfunc(null, "ERROR");
						showOrHideErrorInfo("div_modalErrorInfoArea", true, getTranslationMessage("An error occurred while retrieving the contract details. Contact your administrator."), 10000);
						return false;
					}
				});
			};

		}

        $(function () {
            var i_locale = getlocale();
            var rtl_css = '../../../../../../com/opentext/apps/utils/css/rtlappscommon.css';
            translateLabels("com/opentext/apps/commoncomponents/CCConfigurableWorkflow/CCConfigurableWorkflow", i_locale);
            loadRTLIfRequired(i_locale, rtl_css);

            l_OblItemID1 = getUrlParameterValue("OblItemID1", null, true);
			actionType = getUrlParameterValue("actionType", null, true);
			console.log(l_OblItemID1);
			updateAppsWarningMsg(actionType);
            //Platform dialog enhancements
            platformDialogModifications("Submit", actionType);

            
            ReadObligationStatus();
        });

		function updateAppsWarningMsg(actionType){
		console.log(actionType)
			if(actionType=="invalid"){
				document.querySelector('.apps-warning-msg').innerHTML  = "Are you sure you want to invalidate the obligation?";
			}
			else if(actionType=="inactive"){
				document.querySelector('.apps-warning-msg').innerHTML  = "Are you sure you want to deactivate the obligation?";
			}
		}
		
        function platformDialogModifications(i_newButtonName, i_newButtonAction) {
            $('ai-dialog', window.parent.parent.document).animate({
                'max-height': '20vh',
                'max-width': '30vw',
                'width': '30vw',
                'height': '20vh'
            }, 500);

            //Dialog content style enhancements				
            $('ai-dialog-body iframe', window.parent.parent.document).css({
                'width': '100%',
                'height': 'calc(100% - 10px)'
            });

            $('ai-dialog-body', window.parent.parent.document).css({
                'max-height': 'calc(60vh - 103px)',
                'height': '10vh',
            });

            $('.layout-panel .panel-container', window.parent.document).css({
                'padding-left': '0px'
            });

            $('panel-container iframe', window.parent.document).css({
                'height': 'calc(100% - 6px)',
                'width': '100%',
                'border': '0px'
            });
            //hide OK button
            $('ai-dialog-footer .btn-primary:contains("OK")', window.parent.parent.document).text("Submit");
            
        }

        function ReadObligationStatus() {
            $.cordys.ajax({
                namespace: "http://schemas/OpenTextContractCenter/Contract.Obligations/operations",
                method: "ReadObligations",
                parameters: {
                    "Obligations-id": {
						"ItemId1":l_OblItemID1
					}
                },
                success: function (data) {
				console.log(data);
                    if (data.Obligations.Status && data.Obligations.Status!="ACTIVE") {
                        $('ai-dialog-footer .btn-primary:contains("Submit")', window.parent.parent.document).attr("disabled", true);	
			if(data.Obligations.Status && data.Obligations.Status=="INVALIDINPROGRESS"){
				document.querySelector('.apps-warning-msg').innerHTML  = "Invalidate review is already in progress";
			}
			else if(data.Obligations.Status && data.Obligations.Status=="INACTIVEINPROGRESS"){
				document.querySelector('.apps-warning-msg').innerHTML  = "Deactivate review is already in progress";
			}	
                    }
                },
                error: function (responseFailure) {
                    showOrHideErrorInfo("div_formErrorInfoArea", true, getTranslationMessage("An error occurred while fetching obligation status. Contact the administrator."), 10000);
                    return false;
                }
            });
        }
    </script>
</head>

<body class="cc-ltr">

	<div class="modal-body cc-modal-body" style="margin-top: 20vh;">
		<div class="cc-error-info-area" id="div_formErrorInfoArea">
			<img src="../../../../../com/opentext/apps/utils/img/notification_error.svg"
				style="width: 11px; height: 11px;" />
			<span id="span_errorInfoMessage" style="position: relative;"></span>
		</div>
		<div class="apps-warning-msg" data-translatable="true" style="padding-top: 7px;"></div>
	</div>
</body>

</html>