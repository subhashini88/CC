<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="../../../../../cws/framework/libraries/bootstrap/css/bootstrap.css"></link>
    <link rel="stylesheet" href="../../../../../cws/framework/libraries/bootstrap/css/bootstrap.min.css"></link>
    <link rel="stylesheet" href="../css/appscommon.css"></link>
    <script src="../../../../../thirdparty/jquery/jquery.js" type="text/javascript"></script>
    <script src="../../../../../html5/cordys.html5sdk.js" type="text/javascript"></script>
    <script src="../../../../../thirdparty/knockout/knockout.js" type="text/javascript"></script>
    <script src="../../../../../cws/framework/libraries/bootstrap/js/bootstrap.js" type="text/javascript"></script>
    <script src="../../../../../cws/framework/libraries/bootstrap/js/bootstrap.min.js" type="text/javascript"></script>
   <script src="../../../../../com/opentext/apps/utils/js/appscommon.js" type="text/javascript"></script>
   <script src="../../../../../com/opentext/apps/utils/js/translationsUtil.js" type="text/javascript"></script>
    <script type="text/javascript">
        $.cordys.json.defaults.removeNamespacePrefix = true;
        var ContractListServiceModel;
        var ContractListModel = function() {
            self = this;
            this.Listed_Contracts = ko.observableArray([]);
            this.openSelectedItem = function(iItem) {
                if (iItem["Contract-id"]) {
                    var l_Id = iItem["Contract-id"].Id;

                    var urlToOpen = buildLayoutURL(window.parent.location.href, l_Id);

                    var win = window.parent.location.replace(urlToOpen);
					win.focus();
                }
            }
        }

        function buildLayoutURL(inputURL, ctrId) {
            var inst_item = inputURL.split("items")[0];
            var inst_itemIdPart1 = getUrlParameterValue("instanceId", null, true).split(".")[0];
            var inst_itemIdPart2 = ctrId;
            var inst_itemId2 = inputURL.split(inst_itemIdPart1)[1].split("/")[1];
            return inst_item + "items/" + inst_itemIdPart1 + "." + inst_itemIdPart2 + "/" + inst_itemId2;
        }

        function addDataToView(iElementList, iModel) {
            iModel.Listed_Contracts.removeAll();
            if (iElementList) {
                if (iElementList.length) {
                    iElementList.forEach(function(iElement) {
                        iModel.Listed_Contracts.push(iElement);
                    });
                } else {
                    iModel.Listed_Contracts.push(iElementList);
                }
            }
        }
        $(function() {
			var i_locale = getlocale();
			var rtl_css = '../../../../../com/opentext/apps/utils/css/rtlappscommon.css';
      translateLabels("com/opentext/apps/commoncomponents/ContentLibrary/ContentLibrary", i_locale);
      if(document.getElementById("AMCL_Open")!=null)
      document.getElementById("AMCL_Open").title="Open";
			loadRTLIfRequired(i_locale,rtl_css);
            var contract_list_model = new ContractListModel();
            ko.applyBindings(contract_list_model, document.getElementById("ContractTable"));
            contractItemId = getUrlParameterValue("instanceId", null, true);

            function ListAllContracts(itemId) {
                ContractListServiceModel = $.cordys.ajax({
                    namespace: "http://schemas.opentext.com/apps/contractcenter/16.3",
                    method: "GetAmendedContractsList",
                    parameters: {
                        "ItemId": itemId
                    },
                    success: function(data) {
                        if (data.contracts) {
                            addDataToView(data.contracts.FindAmendListResponse.Contract, contract_list_model);
                        }

                    }
                });
            }
            if (contractItemId) {
                ListAllContracts(contractItemId);
            }
        });
    </script>
    <style>
        #ContractTable > tbody > tr:hover {
            cursor: pointer;
            background-color: #bac9ce;
        }
        #ContractTable > tbody > tr:hover td:first-child {
            text-decoration: underline;
        }
        #ContractTable > thead {
            background-color: #efefef;
        }
        #ContractTable_HeaderRow > th {
            font-weight: normal;
        }
        .ContractTable_DataRow > td > div,
        #ContractTable_HeaderRow > th > div {
            min-height: 20px;
            margin-top: 0.5em;
        }
		@media screen and (max-width: 1024px) {
			.hiddenAttr {
				display: none !important;
			}
		}
    </style>
</head>

<body class="cc-ltr">
    <div class="table-responsive ">
        <table id="ContractTable" class="table">
            <thead>
                <tr id="ContractTable_HeaderRow">
                    <th class="col-lg-2">
                        <div data-translatable="true">Contract id</div>
                    </th>
                    <th class="col-lg-4 hiddenAttr">
                        <div data-translatable="true">Name</div>
                    </th>
                    <th class="col-lg-2 hiddenAttr">
                        <div data-translatable="true">Start date</div>
                    </th>
                    <th class="col-lg-2">
                        <div data-translatable="true">End date</div>
                    </th>
                    <th class="col-lg-2">
                        <div data-translatable="true">Status</div>
                    </th>

                </tr>
            </thead>
            <tbody data-bind="foreach:Listed_Contracts">
                <tr class="ContractTable_DataRow" data-bind="event:{click:$root.openSelectedItem}">
                    <td class="col-lg-2" id="AMCL_Open" data-bind="if:(GeneratedContractId)">
                        <div data-bind="text:GeneratedContractId"></div>
                    </td>
                    <td class="col-lg-4 hiddenAttr" data-bind="if:(ContractName)">
                        <div data-bind="text:ContractName"></div>
                    </td>
                    <td class="col-lg-2 hiddenAttr" data-bind="if:(StartDate)">
                        <div data-bind="text:StartDate.split('Z')[0]"></div>
                    </td>
                    <td class="col-lg-2" data-bind="if:(EndDate)">
                        <div data-bind="text:EndDate.split('Z')[0]"></div>
                    </td>
                    <td class="col-lg-2" data-bind="if:(Lifecycle)">
                        <div data-bind="text:Lifecycle.CurrentState"></div>
                    </td>
                </tr>
            </tbody>
        </table>
    </div>
</body>

</html>