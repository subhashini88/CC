<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="../../../../../thirdparty/bootstrap/css/bootstrap.min.css"></link>
	<link rel="stylesheet" href="../../../../../com/opentext/apps/utils/css/appscommon.css">
    <link rel="stylesheet" href="../css/appscommon.css" />
    <script src="../../../../../thirdparty/jquery/jquery.js" type="text/javascript"></script>
    <script src="../../../../../html5/cordys.html5sdk.js" type="text/javascript"></script>
    <script src="../../../../../html5/thirdparty/moment.js" type="text/javascript"></script>
    <script src="../../../../../thirdparty/knockout/knockout.js" type="text/javascript"></script>
    <script src="../../../../../thirdparty/bootstrap/js/bootstrap.min.js" type="text/javascript"></script>
    <script src="../../../../../com/opentext/apps/utils/js/appscommon.js" type="text/javascript"></script>
	<script src="../../../../../com/opentext/apps/utils/js/translationsUtil.js" type="text/javascript"></script>

    <script type="text/javascript">
        $.cordys.json.defaults.removeNamespacePrefix = true;
        var TemplateListServiceModel;
		var i_locale;
        var TemplateListModel = function () {
            self = this;
            this.Version_List = ko.observableArray([]);
            this.openSelectedItem = function (iItem) {
                if (iItem["GCTemplate-id"]) {
					
					var l_ItemId =iItem["GCTemplate-id"].ItemId;
					var l_Id = iItem["GCTemplate-id"].Id;
					navigateToInstance(l_ItemId,"Template",{"layoutID":'C4D98747A6D9A1E8AC6C233A4C55886E', "clearBreadcrumb":false,"breadcrumbName" : ''});
                }
            }

        }

        var template_list_model = new TemplateListModel();
        var isVersionsAreThere = false;

        $(function () {
			i_locale = getlocale();
			var rtl_css = '../../../../../com/opentext/apps/utils/css/rtlappscommon.css';
      translateLabels("com/opentext/apps/commoncomponents/ContentLibrary/ContentLibrary", i_locale);
      if(document.getElementById("TV_TemplateID")!=null)
      document.getElementById("TV_TemplateID").title="Template ID";
      if(document.getElementById("TV_Version")!=null)
      document.getElementById("TV_Version").title="Version";
      if(document.getElementById("TV_State")!=null)
      document.getElementById("TV_State").title="State";
      if(document.getElementById("TV_ModifiedOn")!=null)
      document.getElementById("TV_ModifiedOn").title="Modified on";
      if(document.getElementById("TV_ModifiedBy")!=null)
      document.getElementById("TV_ModifiedBy").title="Modified by";
      if(document.getElementById("TV_ChangeSummary")!=null)
      document.getElementById("TV_ChangeSummary").title="Change summary";
      if(document.getElementById("TV_Open")!=null)
      document.getElementById("TV_Open").title="Open";
			loadRTLIfRequired(i_locale,rtl_css);
            $('[src*="TemplateVersions.htm"]', window.parent.parent.document).parent().css('padding-left', '0px');
            ko.applyBindings(template_list_model, document.getElementById("TemplateTable"));
            TemplateIdentifier = getUrlParameterValue("templateIdentifier", null, true);
            ItemId = getUrlParameterValue("instanceId", null, true);;

            function ListAllTemplates(TemplateIdentifier) {
                TemplateListServiceModel = $.cordys.ajax({
                    namespace: "http://schemas/OpenTextContentLibrary/16.5",
                    method: "GetAllVersionsOfATemplate",
                    parameters: '<TemplateIdentifier xmlns="http://schemas.cordys.com/default">' +
                        TemplateIdentifier + '</TemplateIdentifier>',
                    success: function (data) {
                        if (data.Versions && data.Versions.FindZ_INT_TemplateVersionsListResponse &&
                            data.Versions.FindZ_INT_TemplateVersionsListResponse.GCTemplate){
							if((data.Versions.FindZ_INT_TemplateVersionsListResponse.GCTemplate.length && data.Versions.FindZ_INT_TemplateVersionsListResponse.GCTemplate[0].TemplateType == "Internal template") || data.Versions.FindZ_INT_TemplateVersionsListResponse.GCTemplate.TemplateType == "Internal template")
								addDataToView(ItemId, data.Versions.FindZ_INT_TemplateVersionsListResponse.GCTemplate, template_list_model);
							else if(data.Versions.FindZ_INT_TemplateVersionsListResponse.GCTemplate.TemplateType == "Internal party document"){
								$('.version_tab').css('display', 'none');
								$('#internalPartyDocumentType').css('display', 'block');
							}
							else if(data.Versions.FindZ_INT_TemplateVersionsListResponse.GCTemplate.TemplateType == "External party document"){
								$('.version_tab').css('display', 'none');
								$('#externalPartyDocumentType').css('display', 'block');
							}
                        }
                    }
                });
            }
            if (TemplateIdentifier) {
                ListAllTemplates(TemplateIdentifier);
            }
        });


        function addDataToView(ItemId, iElementList, iModel) {
            iModel.Version_List.removeAll();
            if (iElementList) {
                if (iElementList.length) {
                    isVersionsAreThere = true;
                    iElementList.forEach(function (iElement) {
                        iModel.Version_List.push(iElement);

                    });
                } else {

                    iModel.Version_List.push(iElementList);
                }
            }
        }
    </script>
    <style>
        #TemplateTable>tbody>tr:hover {
            cursor: pointer;
            background-color: #a0a4bc !important;
            color: #333333 !important;
        }

        #TemplateTable>tbody>tr:hover td:first-child {
            text-decoration: underline;
        }

        #TemplateTable>thead {
            background-color: #efefef;
        }

        #TemplateTable_HeaderRow>th {
            font-weight: normal;
            vertical-align: top;
            width: 10px;
        }

        .TemplateTable_DataRow>td>div,
        #TemplateTable_HeaderRow>th>div {
            margin-top: 0.5em;
        }

        #TemplateTable_HeaderRow>th>div {
            white-space: nowrap;
            width: 75%;
            overflow: hidden;
            text-overflow: ellipsis;
        }
    </style>
</head>

<body class="cc-ltr">
	<div id="internalPartyDocumentType" class="col-xs-12 defaultInfo" style="display: none;padding-top:15% !important;">
		<p data-translatable="true">Versions cannot be created for the Internal party document template type.</p>
	</div>
	<div id="externalPartyDocumentType" class="col-xs-12 defaultInfo" style="display: none;padding-top:15% !important;">
		<p data-translatable="true">Versions cannot be created for the External party document template type.</p>
	</div>
    <div class="version_tab" data-bind="if:true">
        <div class="table-responsive ">
            <table id="TemplateTable" class="table">
                <thead>
                    <tr id="TemplateTable_HeaderRow">
                        <th class="col-2" id="TV_TemplateID">
                            <div><label class="label-no-bold" data-translatable="true">Template ID</label></div>
                        </th>
                        <th class="col-1" id="TV_Version">
                            <div><label class="label-no-bold" data-translatable="true">Version</label></div>
                        </th>
                        <th class="col-2" id="TV_State">
                            <div><label class="label-no-bold" data-translatable="true">State</label></div>
                        </th>
                        <th class="col-2" id="TV_ModifiedOn">
                            <div><label class="label-no-bold" data-translatable="true">Modified on</label></div>
                        </th>
                        <th class="col-1" id="TV_ModifiedBy">
                            <div><label class="label-no-bold" data-translatable="true">Modified by</label></div>
                        </th>
                        <th class="col-3" id="TV_ChangeSummary">
                            <div><label class="label-no-bold" data-translatable="true">Change summary</label></div>
                        </th>
                    </tr>
                </thead>
                <tbody data-bind="foreach:Version_List">
                    <tr class="TemplateTable_DataRow" data-bind="event:{click:$root.openSelectedItem}">
                        <td class="col-1" id="TV_Open" data-bind="if:(TemplateId)">
                            <div data-bind="text:TemplateId"></div>
                        </td>
                        <td class="col-2" data-bind="if:(Version)">
                            <div data-bind="text:Version"></div>
                        </td>
                        <td class="col-2" data-bind="if:(Lifecycle.CurrentState)">
                            <div data-bind="text:Lifecycle.CurrentState"></div>
                        </td>
                        <td class="col-1" data-bind="if:(Tracking.LastModifiedDate)">
                            <div data-bind="text:moment(Tracking.LastModifiedDate).format('DD/MM/YYYY h:mm:ss A')">
                            </div>
                        </td>
                        <td class="col-1" data-bind="if:(LastModifiedBy.UserId.text)">
                            <div data-bind="text:LastModifiedBy.UserId.text"></div>
                        </td>
                        <td class="col-3" data-bind="if:(VersionSummary)">
                            <div data-bind="text:VersionSummary"></div>
                        </td>
                    </tr>
                </tbody>
            </table>
        </div>
    </div>
</body>

</html>