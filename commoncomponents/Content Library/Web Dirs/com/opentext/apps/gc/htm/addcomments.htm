<!DOCTYPE html>
<html>

<head>
	<title data-translatable="true">Add comments</title>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<link rel="stylesheet" href="../../../../../thirdparty/bootstrap/css/bootstrap.min.css">
	</link>
	<link rel="stylesheet" href="../css/appscommon.css">
	</link>
	<script src="../../../../../thirdparty/jquery/jquery.js" type="text/javascript"></script>
	<script src="../../../../../html5/cordys.html5sdk.js" type="text/javascript"></script>
	<script src="../../../../../thirdparty/knockout/knockout.js" type="text/javascript"></script>
	<script src="../../../../../thirdparty/bootstrap/js/bootstrap.min.js" type="text/javascript"></script>
	<script src="../../../../../com/opentext/apps/utils/js/appscommon.js" type="text/javascript"></script>
	<script src="../../../../../com/opentext/apps/utils/js/translationsUtil.js" type="text/javascript"></script>
	<style>
		.comments-frame-area {
			height: 100vh;
			padding: 0;
			border-left: 1px solid #efefef;
		}

		.comments-frame {
			height: 99%;
			width: 100%;
			border: 0;
		}
	</style>
	<script type="text/javascript">
		$.cordys.json.defaults.removeNamespacePrefix = true;
		window.ccactionPerformed = false;
		var CommentsDataModel = function () {
			var self = this;
			self.comments = ko.observable();
			self.clauseID = ko.observable();
		}
		var commentsModel = new CommentsDataModel();

		$(function () {
			var i_locale = getlocale();
			var rtl_css = '../../../../../com/opentext/apps/utils/css/rtlappscommon.css';
			translateLabels("com/opentext/apps/commoncomponents/ContentLibrary/ContentLibrary", i_locale);
			loadRTLIfRequired(i_locale,rtl_css);
			$('[src*="addcomments.htm"]', window.parent.parent.document).height("250px");
			$('[src*="addcomments.htm"]', window.parent.parent.document).parent().css('overflow', 'hidden');
			cInstanceId = getUrlParameterValue("instanceId", null, true);
			getGCClauseComments();

			window.parent.$("ai-dialog-footer bs-button[click-event-name='ok'] button").click(function () {
				window.ccactionPerformed = true;
			});

		});

		function getGCClauseComments() {
			CommentsDataModel = $.cordys.ajax(
				{
					namespace: "http://schemas/OpenTextContentLibrary/GCClause/operations",
					method: "ReadGCClause",
					parameters:
					{
						"GCClause-id":
						{
							"ItemId": cInstanceId
						}
					},
					success: function (data) {
						if (data) {
							commentsModel.comments = data.GCClause.Comments;
							commentsModel.clauseID = data.GCClause["GCClause-id"].Id;
							ko.applyBindings(commentsModel, document.getElementById("commentsDiv"));
						}
					}
				});
		}

		function updateCommentsValue(val) {
			if (val != "") {
				return val;
			}
			else {
				return { '@xsi:nil': 'true' };
			}
		}

		function updateComments(value) {
			$.cordys.ajax(
				{
					method: "UpdateGCClause",
					namespace: "http://schemas/OpenTextContentLibrary/GCClause/operations",
					parameters:
					{
						"GCClause-id": {
							"Id": commentsModel.clauseID
						},
						"GCClause-update": {
							"@xmlns:xsi": "http://www.w3.org/2001/XMLSchema-instance",
							"Comments": updateCommentsValue(value)
						}
					},
				}).done(function (data) {
					
				}).fail(function (error) {
					
				})
		}

		$(window).on("unload", function(e) {
				if (window.parent.parent && window.ccactionPerformed) {
					clauseSummaryFrame = $('[src*="clausesummary.htm"]', window.parent.parent.document)[0];
					if (clauseSummaryFrame) {
						//clauseSummaryFrame.contentWindow.editClauseDetailsDisable();
						clauseSummaryFrame.src+='';
					}
				}
		});
	</script>
</head>

<body class="cc-ltr">
	<div id="commentsDiv" class="form-group cc-formgroup-no-float col-lg-12"
		style="padding-left: 50px; padding-right: 40px; padding-top: 30px;">
		<label class="label-no-bold" style="color: #757575;" data-translatable="true">Comments</label>
		<div>
			<textarea class="apps-contentDiv" data-bind="html:comments" onchange="updateComments(this.value)" rows="7"
				style="resize: none;"></textarea>
		</div>
	</div>
</body>

</html>